import { defineEventHandler, getRouterParam, readBody } from 'h3';
import { Audit } from '../../../../app/audit.service';
import { environment } from '../../../../environments/environment';

export default defineEventHandler(async (event) => {
  const id = getRouterParam(event, 'id');

  let sampleAudit: Audit = {
    data: {
      "id": 68,
      "name": "string",
      "url": "https://www.fliphound.com",
      "closerAudit": "# Website Analysis Report\n\n## Introduction\n- Website: Fliphound\n- Purpose: To evaluate the effectiveness of Fliphound's website in communicating its value proposition and engaging potential customers.\n\n## Three Key Questions\n### Who are you/What do you do?\n- The headline \"Digital Billboard Advertising Made Easy\" clearly states what Fliphound does.\n- Suggestion: Add a subheadline that explicitly states who the service is for (e.g., \"For businesses looking to reach local audiences with impactful outdoor advertising\").\n- The \"How It Works\" section provides more detail, but it could be more prominent on the page.\n\n### What's in it for me?\n- The benefits are not immediately clear on the landing page.\n- Suggestion: Add a section with 3-4 key benefits, using icons for visualization. For example:\n  1. Reach local audiences effectively\n  2. Flexible, budget-friendly campaigns\n  3. Easy-to-use platform\n  4. Real-time performance tracking\n\n### Why should I trust you?\n- There are no visible testimonials or trust indicators on the landing page.\n- Suggestion: Add a testimonial slider with quotes from satisfied customers.\n- Recommendation: Include statistics such as \"X+ successful campaigns\" or \"Y+ businesses served\" to build credibility.\n\n## Hero Section\n- The hero section includes a clear headline and a relevant image of a digital billboard.\n- The call-to-action (CTA) \"Get Started\" is present but could be more compelling.\n- Suggestions for improvement:\n  1. Add a subheadline that elaborates on the main value proposition.\n  2. Use a more specific CTA like \"Create Your First Campaign\" or \"Get a Free Quote\".\n  3. Include a secondary CTA for those who want to learn more before committing.\n  4. Consider adding a brief video showcasing real businesses using Fliphound's service.\n- The image is relevant but static. Consider using a dynamic image or video that shows the process of creating and displaying an ad on a digital billboard.Based on the analysis of https://www.fliphound.com, here's the detailed website analysis report:\n\n## Framework for High-Converting Websites\n\n### Compelling Hero Section\n- The hero section lacks impact and clarity. It features a rotating banner with multiple messages, which can be confusing.\n- The value proposition is not immediately clear, and the main headline \"Outdoor Digital Advertising\" is too generic.\n- Suggestion: Create a static hero section with a clear, compelling headline that communicates the unique value proposition of Fliphound.\n\n### Loaded Persuasion (Copywriting)\n- The copywriting is informative but lacks persuasive elements.\n- There's an absence of emotional triggers and benefit-focused language.\n- Suggestion: Rewrite copy to focus on the benefits of using Fliphound, using more persuasive language and addressing customer pain points.\n\n### Objection Handling\n- The website does not proactively address common objections.\n- There's no clear section dedicated to overcoming potential customer concerns.\n- Suggestion: Add a section that addresses common objections about digital billboard advertising, such as cost, effectiveness, or complexity.\n\n### Solidifying Trust\n- The website lacks prominent testimonials or case studies.\n- There's a small \"Featured In\" section, but it's not prominently displayed.\n- Suggestion: Add a dedicated testimonials section with quotes from satisfied clients and showcase detailed case studies demonstrating ROI.\n\n### Exclusive Offer\n- There's no clear exclusive offer or compelling deal presented on the homepage.\n- Suggestion: Create a limited-time offer or exclusive package for new customers to encourage immediate action.\n\n### Reducing Friction\n- The navigation is clear, but the process to get started is not immediately obvious.\n- The \"Get Started\" button leads to a contact form, which may be too big a commitment for new visitors.\n- Suggestion: Simplify the initial engagement process, perhaps offering a free consultation or a demo before asking for extensive contact information.\n\n## Recommendations\n\n### Navigation and Call to Action\n- Add a clear \"How It Works\" section in the main navigation.\n- Make the \"Get Started\" CTA more prominent and consider changing it to \"Get a Free Quote\" or \"See Available Billboards\" to reduce perceived commitment.\n\n### Testimonials\n- Create a dedicated testimonials page with detailed client success stories.\n- Add video testimonials from satisfied customers to increase credibility.\n\n### Ingredients Breakdown\n- Not applicable for this type of service. However, consider creating a \"Features\" section that breaks down the components of the Fliphound platform.\n\n### Product Information\n- Create a more detailed \"Services\" page that clearly outlines what Fliphound offers.\n- Use infographics or interactive elements to explain the digital billboard advertising process.\n\n### Scientific Stats\n- Add a \"Data & Analytics\" section showcasing statistics on the effectiveness of digital billboard advertising.\n- Include industry benchmarks and Fliphound's performance metrics to build credibility.\n\n### FAQs\n- Add a comprehensive FAQ section addressing common questions about digital billboard advertising and using Fliphound's platform.\n- Organize FAQs by categories such as \"Getting Started,\" \"Pricing,\" \"Technology,\" etc.\n\n### Competitor Analysis\n- The website lacks some features found on competitor sites, such as interactive maps of billboard locations and real-time availability.\n- Consider adding a live demo of the platform to showcase its ease of use compared to competitors.\n- Highlight unique features that set Fliphound apart from traditional billboard advertising companies.\n\n## Conclusion\n\nFliphound's website provides basic information about their digital billboard advertising services but falls short in several key areas that could significantly improve conversion rates. The main areas for improvement include:\n\n1. Enhancing the hero section with a clearer value proposition\n2. Improving copywriting to be more persuasive and benefit-focused\n3. Adding trust elements such as testimonials and case studies\n4. Creating a more compelling and frictionless path to engagement\n\nBy implementing these changes, Fliphound can create a more effective website that better communicates its value, builds trust with potential clients, and ultimately drives more conversions. It's recommended that Fliphound consider a professional redesign to fully optimize their online presence and capitalize on the growing digital outdoor advertising market.",
      "createdAt": "2024-07-23T14:45:13.1482339",
      "lastUpdated": "2024-07-23T14:45:13.1482644",
      "customer": {
        "id": undefined,
        "firstName": undefined,
        "lastName": undefined,
        "email": undefined,
        "phoneNumber": undefined,
        "address": undefined,
        "city": undefined,
        "state": undefined,
        "postalCode": undefined,
        "country": undefined,
        "createdAt": undefined,
        "lastUpdated": undefined
      },
      "customerId": undefined,
      "bestPracticesMetricsSummary": "Summary of Results:\n\n- The overall score of the website is 0.78 out of 1, indicating that there is room for improvement in implementing best practices.\n- The following audits have a score of 0, meaning they need attention: \"errors-in-console,\" \"deprecations,\" and \"valid-source-maps.\"\n- The website has a `<meta name=\"viewport\">` tag with `width` or `initial-scale`, optimizing it for mobile screen sizes and preventing a delay in user input.\n- Images on the website have the correct aspect ratio and are displayed appropriately.\n- The Content Security Policy (CSP) used on the website is effective against XSS attacks, which reduces the risk of cross-site scripting.\n- The website uses legible font sizes with more than 60% of page text at least 12px in size.\n- Images on the website are served with appropriate resolutions, maximizing image clarity based on display size and pixel ratio.\n- The website avoids the use of third-party cookies, in line with the future removal of support for them in Chrome.\n- The HTML doctype is properly specified, preventing the browser from switching to quirks-mode.\n- The website avoids requesting the notification permission on page load, enhancing user experience and trust.\n- There are no issues in the `Issues` panel in Chrome DevTools, indicating a good control on network request failures and security concerns.\n- The website properly defines the character encoding, either through a `<meta>` tag or Content-Type HTTP response header.\n- The website allows users to paste into input fields, which improves user experience and does not compromise security.\n- JavaScript libraries used on the website are detected and documented.\n- The website is on HTTPS, ensuring secure communication and compatibility with HTTP/2 and new web platform APIs.\n- Source maps for large first-party JavaScript are missing, which hinders debugability and insights through Lighthouse.\n- The website avoids requesting the geolocation permission on page load, providing context and user control.\n\nRecommendations:\n\n1. Address and resolve errors logged to the console.\n2. Update or remove the usage of deprecated APIs.\n3. Implement source maps for large first-party JavaScript files for enhanced debugging.\n4. Continuously monitor and address any new warnings or issues in the `Issues` panel of Chrome DevTools.\n5. Consider implementing a better solution for the use of third-party cookies to ensure compatibility with future versions of Chrome.\n6. Review and optimize the usage of the Content Security Policy (CSP) to further enhance security.\n7. Ensure all pages of the website have the HTML doctype specified.\n8. Optimize font sizes to improve legibility, aiming for at least 60% of the page text to be 12px or larger.\n9. Continuously update JavaScript libraries used on the website to their latest versions for improved security and performance.\n10. Consider implementing support for requesting notifications based on user gestures, rather than on page load.\n11. Confirm proper declaration of character encoding for all pages of the website.\n12. Implement redirects to ensure all HTTP traffic is automatically redirected to HTTPS.\n13. Evaluate the possibility of deploying responsive images to further optimize the visual experience.\n14. Periodically review and update the website's usage of geolocation permissions to provide better user context and control.\n\nThese recommendations will help improve the overall performance, usability, and security of the website while adhering to best practices.",
      "performanceMetricsSummary": "Performance Metrics Audit Results Summary:\n\nOverall Score: 0.75\n\nPerformance Metrics:\n\n1. First Contentful Paint: 0.87 (1.0 s)\n   The first content on the page takes approximately 1.0 second to appear.\n\n2. Largest Contentful Paint: 0.46 (2.5 s)\n   The largest piece of content on the page takes around 2.5 seconds to load.\n\n3. Total Blocking Time: 0.75 (220 ms)\n   The total time spent on blocking page rendering is 220 milliseconds.\n\n4. Cumulative Layout Shift: 1.0 (0.002)\n   The page has minimal unexpected layout shifts with a score of 1.0.\n\n5. Speed Index: 0.76 (1.7 s)\n   The visual stability of the page is good, but it takes approximately 1.7 seconds for the entire page to become visually complete.\n\n6. Time to Interactive: 0.68 (3.6 s)\n   The page becomes interactable after around 3.6 seconds.\n\nAudit Recommendations:\n\n1. Eliminate render-blocking resources:\n   Consider delivering critical CSS and JavaScript inline and deferring non-critical resources to speed up the first paint. Potential savings of 120 ms.\n\n2. Properly size images:\n   Serve appropriately sized images to improve loading time and save cellular data.\n\n3. Defer offscreen images:\n   Consider lazy-loading offscreen and hidden images after critical resources have finished loading to enhance interactivity.\n\n4. Minify CSS:\n   Minify CSS files to reduce network payload sizes.\n\n5. Minify JavaScript:\n   Minify JavaScript files to reduce payload size and script parse time. Potential savings of 33 KiB.\n\n6. Reduce unused CSS:\n   Remove unused CSS rules and defer the loading of CSS not required for above-the-fold content to reduce network activity. Potential savings of 138 KiB.\n\n7. Reduce unused JavaScript:\n   Remove unused JavaScript and defer loading scripts until required to decrease network activity. Potential savings of 1,624 KiB.\n\n8. Efficiently encode images:\n   Optimize images to improve loading speed and reduce cellular data consumption. Potential savings of 27 KiB.\n\n9. Avoid enormous network payloads:\n   Decrease payload sizes as they contribute to longer load times and increased user costs. The total size is currently 3,518 KiB.\n\nIt is recommended to address the above recommendations to improve the overall performance of the website.",
      "seoMetricsSummary": "Summary of SEO Metrics Audit Results:\n\n1. Document Title: Score - 1.0/1.0\nThe page has a `<title>` element that provides an overview of the content. This is beneficial for search engine users. No issues found.\n\n2. Meta Description: Score - 1.0/1.0\nThe page has a meta description that concisely summarizes the content. This can be used in search results. No issues found.\n\n3. HTTP Status Code: Score - 1.0/1.0\nThe page has a successful HTTP status code, indicating that it can be indexed properly. No issues found.\n\n4. Link Text: Score - 0.0/1.0 (3 links found)\nThe links on the page do not have descriptive text. It is important to ensure that link text is descriptive to help search engines understand the content. Recommendations: Modify the link text to be more descriptive and relevant to the linked content.\n\n5. Crawlable Anchors: Score - 0.0/1.0\nThe links on the page are not crawlable, which means that search engines may not be able to discover more pages of the site. Recommendations: Ensure that the `href` attribute of anchor elements links to appropriate destinations to make the links crawlable.\n\n6. Page Indexing: Score - 1.0/1.0\nThe page is not blocked from indexing, ensuring that search engines can include it in search results. No issues found.\n\n7. Robots.txt: Score - Not Applicable\nThe validity of the robots.txt file was not determined during the audit.\n\n8. Image Alt Attributes: Score - 0.0/1.0\nThe image elements on the page do not have `[alt]` attributes. Informative elements should have short, descriptive alternate text, while decorative elements can have an empty `alt` attribute. Recommendations: Add appropriate `[alt]` attributes to image elements.\n\n9. hreflang: Score - 1.0/1.0\nThe page has a valid `hreflang` attribute, which informs search engines about the language or region versions of the page. No issues found.\n\n10. Canonical: Score - Not Applicable\nThe presence of a valid `rel=canonical` link was not determined during the audit.\n\nRecommendations:\n\n1. Update link text to be descriptive and relevant to the linked content.\n2. Ensure that the `href` attribute of anchor elements links to appropriate destinations for better crawlability.\n3. Add `[alt]` attributes to image elements with descriptive alternate text.\n4. If applicable, review the validity of the robots.txt file.\n5. Consider implementing a valid `rel=canonical` link if necessary.\n\nNote: It's recommended to further investigate the validity of the robots.txt file and the presence of canonical links as these aspects were not covered in the audit."
    },
    success: true,
  }

  try {
    const response = await fetch(`${environment.remoteApiHost}auditproject?id=${id}`);
    const data = await response.json()
    return {
      success: true,
      data: data,
    };
  } catch (error) {
    const err = error as Error;
    return {
      success: false,
      message: 'Error: ' + err.message,
    };
  }
});

